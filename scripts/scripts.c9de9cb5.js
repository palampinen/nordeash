!function(a){"function"==typeof define&&define.amd?define(["moment"],a):"object"==typeof exports?module.exports=a(require("../moment")):a(("undefined"!=typeof global?global:this).moment)}(function(a){function b(a,b,d,e){var f="";switch(d){case"s":return e?"muutaman sekunnin":"muutama sekunti";case"m":return e?"minuutin":"minuutti";case"mm":f=e?"minuutin":"minuuttia";break;case"h":return e?"tunnin":"tunti";case"hh":f=e?"tunnin":"tuntia";break;case"d":return e?"päivän":"päivä";case"dd":f=e?"päivän":"päivää";break;case"M":return e?"kuukauden":"kuukausi";case"MM":f=e?"kuukauden":"kuukautta";break;case"y":return e?"vuoden":"vuosi";case"yy":f=e?"vuoden":"vuotta"}return f=c(a,e)+" "+f}function c(a,b){return 10>a?b?e[a]:d[a]:a}var d="nolla yksi kaksi kolme neljä viisi kuusi seitsemän kahdeksan yhdeksän".split(" "),e=["nolla","yhden","kahden","kolmen","neljän","viiden","kuuden",d[7],d[8],d[9]];return a.defineLocale("fi",{months:"tammikuu_helmikuu_maaliskuu_huhtikuu_toukokuu_kesäkuu_heinäkuu_elokuu_syyskuu_lokakuu_marraskuu_joulukuu".split("_"),monthsShort:"tammi_helmi_maalis_huhti_touko_kesä_heinä_elo_syys_loka_marras_joulu".split("_"),weekdays:"sunnuntai_maanantai_tiistai_keskiviikko_torstai_perjantai_lauantai".split("_"),weekdaysShort:"su_ma_ti_ke_to_pe_la".split("_"),weekdaysMin:"su_ma_ti_ke_to_pe_la".split("_"),longDateFormat:{LT:"HH.mm",LTS:"HH.mm.ss",L:"DD.MM.YYYY",LL:"Do MMMM[ta] YYYY",LLL:"Do MMMM[ta] YYYY, [klo] LT",LLLL:"dddd, Do MMMM[ta] YYYY, [klo] LT",l:"D.M.YYYY",ll:"Do MMM YYYY",lll:"Do MMM YYYY, [klo] LT",llll:"ddd, Do MMM YYYY, [klo] LT"},calendar:{sameDay:"[tänään] [klo] LT",nextDay:"[huomenna] [klo] LT",nextWeek:"dddd [klo] LT",lastDay:"[eilen] [klo] LT",lastWeek:"[viime] dddd[na] [klo] LT",sameElse:"L"},relativeTime:{future:"%s päästä",past:"%s sitten",s:b,m:b,mm:b,h:b,hh:b,d:b,dd:b,M:b,MM:b,y:b,yy:b},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}),angular.module("nordeashApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","tc.chartjs"]).config(["$routeProvider",function(a){a.when("/lataa",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).otherwise({redirectTo:"/lataa"})}]),angular.module("nordeashApp").controller("MainCtrl",["$scope","$timeout","Bank","Chart","$http",function(a,b,c,d,e){a.chartoptions=d.chartoptions,a.banks=["Nordea","Osuuspankki"],a.my={bank:"Nordea"},a.timeInterval=[],a.upload=function(b){console.log(a.my.bank),a.my.bank&&(a.loading=!0,c.upload("csvFile",a.my.bank,g))};var f=function(a){var b,c,d={},e={};return moment.locale("fi"),_.map(a,function(a){b=moment(a.date,"DD.MM.YYYY").format("MMM YYYY"),a.sum+="",c=parseFloat(a.sum.replace(",",".")),c>0?(e[b]||(e[b]={sum:0}),e[b].sum+=c):(d[b]||(d[b]={sum:0}),d[b].sum+=-1*c)}),{income:e,outcome:d}},g=function(c){a.bankdata=c,a.timeInterval.push(c[0].date),a.timeInterval.push(c[c.length-1].date);for(var d=moment(a.timeInterval[0],"DD.MM.YYYY"),e=moment(a.timeInterval[1],"DD.MM.YYYY"),g=d.format("M"),h=d.format("YYYY"),i=e.format("M"),j=e.format("YYYY"),k=[],l=[],m=[],n=g;i>=n&&h==j&&12>=n||h!=j&&12>=n;n++)k.push(moment(h+"-"+n,"YYYY-M").format("MMM YYYY"));for(var o=parseInt(h)+1;j>=o;o++)for(var n=1;i>=n&&o==j&&12>=n||o!=j&&12>=n;n++)k.push(moment(o+"-"+n,"YYYY-M").format("MMM YYYY"));a.dateRange=k,a.chartdata={labels:k,datasets:[{label:"Menot",fillColor:"rgba(0,0,0,0)",strokeColor:"#fa4789",pointColor:"#fa4789",pointStrokeColor:"#eee",pointHighlightFill:"#B2305F",data:_.map(k,function(a){return 0})},{label:"Tulot",fillColor:"rgba(0,0,0,0)",strokeColor:"#44AAE5",pointColor:"#44AAE5",pointStrokeColor:"#eee",pointHighlightFill:"#399ACE",data:_.map(k,function(a){return 0})}]};var p=f(c);a.chartdata.datasets[0].data=_.map(k,function(a){return p.outcome[a]&&p.outcome[a].sum?Math.round(10*p.outcome[a].sum)/10:0}),a.chartdata.datasets[1].data=_.map(k,function(a){return p.income[a]&&p.income[a].sum?Math.round(10*p.income[a].sum)/10:0});var q=_.groupBy(c,function(a){return a.target.toLowerCase().trim()});_.map(q,function(a,b){var c,d=[],e=[];_.map(a,function(a){parseFloat(a.sum.replace(",","."))>0?e.push(a):d.push(a)}),d.length&&(c=Math.round(_.reduce(d,function(a,b){var c=-1*parseFloat(b.sum.replace(",","."));return c>0?a+c:a},0)),l.push({id:b,percentage:0,length:d.length,sum:c,avg:Math.round(c/d.length*10)/10})),e.length&&(c=Math.round(_.reduce(e,function(a,b){var c=parseFloat(b.sum.replace(",","."));return c>0?a+c:a},0)),m.push({id:b,percentage:0,length:e.length,sum:c,avg:Math.round(c/e.length*10)/10}))}),l=_.sortBy(l,function(a){return a.sum}).reverse(),m=_.sortBy(m,function(a){return a.sum}).reverse(),a.outcome=l,a.income=m,b(function(){a.outcome=_.map(a.outcome,function(a){return a.percentage=Math.round(a.sum/l[0].sum*100),a}),a.income=_.map(a.income,function(a){return a.percentage=Math.round(a.sum/m[0].sum*100),a}),a.loading=!1},3e3),a.loaded=!0,a.mode="outcome",b(function(){window.scrollTo(0,$("#account-menu").offset().top)},100)};a.total=function(b,c){return _.reduce(b,function(b,c){return a.hidden.indexOf(c.id)>=0?b:b+parseInt(c.sum)},0)},a.changeMode=function(b){a.mode=b},a.hidden=[],a.hide=function(b){a.hidden.indexOf(b)>=0?a.hidden=_.without(a.hidden,b):a.hidden.push(b)},a.reCalcChart=function(b,c){var d,e=a.bankdata;c=(c||"").toLowerCase(),e=_.filter(e,function(b){return d=b.target.toLowerCase(),d.indexOf(c)>=0&&a.hidden.indexOf(d)<0});var g=f(e);b?(a.chartdata.datasets[0].data=_.map(a.dateRange,function(a){return g.outcome[a]&&g.outcome[a].sum?Math.round(10*g.outcome[a].sum)/10:0}),a.chartdata.datasets[1].data=c.length?[]:_.map(a.dateRange,function(a){return g.income[a]&&g.income[a].sum?Math.round(10*g.income[a].sum)/10:0})):(a.chartdata.datasets[1].data=_.map(a.dateRange,function(a){return g.income[a]&&g.income[a].sum?Math.round(10*g.income[a].sum)/10:0}),a.chartdata.datasets[0].data=c.length?[]:_.map(a.dateRange,function(a){return g.outcome[a]&&g.outcome[a].sum?Math.round(10*g.outcome[a].sum)/10:0}))}}]).directive("customOnChange",function(){return{restrict:"A",link:function(a,b,c){var d=b.scope()[c.customOnChange];b.bind("change",d)}}}),angular.module("nordeashApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("nordeashApp").service("Bank",function(){var a={nordea:{delimiter:new RegExp('(	(?=(?:(?:[^"]*"){2})*[^"]*$))',"g"),date:0,sum:3,target:4,startRow:3},osuuspankki:{delimiter:new RegExp(";","g"),date:0,sum:2,target:5,startRow:1}},b=function(b,c,d){for(var e=[],f=b.split("\n"),g=a[c].delimiter,h=a[c].startRow;h<f.length;h++){f[h]=f[h].replace(g,"{;}");var i=f[h].split("{;}").slice(0,6);i[a[c].date]&&i[a[c].sum]&&e.push({date:i[a[c].date],sum:i[a[c].sum],target:i[a[c].target]})}d(e)};return{upload:function(a,c,d){c=c.toLowerCase();var e=document.getElementById(a),f=/^([a-zA-Z0-9\s_\\.\-:])+(.csv|.txt)$/;if(f.test(e.value.toLowerCase()))if("undefined"!=typeof FileReader){var g=new FileReader;g.onload=function(a){b(a.target.result,c,d)},g.readAsText(e.files[0])}else alert("This browser does not support HTML5.");else alert("Please upload a valid CSV/TXT file.")},parseCSV:function(a,c,d){return b(a,c,d)}}}),angular.module("nordeashApp").service("Chart",function(){return{chartdata:[{labels:["Monday","Tuesday","Wednesday","Thursday","Friday"],datasets:[{label:"Testdata",fillColor:"rgba(0,96,112,0.1)",strokeColor:"#006070",pointColor:"#006070",pointStrokeColor:"#006070",pointHighlightFill:"#fff",data:_.sortBy(_.range(5),function(a){return Math.random(1)})}]}],chartoptions:{animation:!0,animationSteps:45,animationEasing:"easeOutQuart",showScale:!1,scaleOverride:!1,scaleSteps:null,scaleStepWidth:null,scaleStartValue:null,scaleLineColor:"rgba(0,0,0,.0)",scaleLineWidth:1,scaleShowLabels:!1,scaleLabel:"<%=value%>",scaleIntegersOnly:!0,scaleBeginAtZero:!1,scaleFontFamily:"'Source Sans Pro','Segoe UI','Helvetica Neue', 'Helvetica', 'Arial', sans-serif",scaleFontSize:12,scaleFontStyle:"900",scaleFontColor:"#666",responsive:!0,maintainAspectRatio:!1,showTooltips:!0,tooltipEvents:["mousemove","touchstart","touchmove"],tooltipFillColor:"rgba(63,68,100,0.7)",tooltipFontFamily:"'Source Sans Pro','Helvetica Neue', 'Helvetica', 'Segoe UI','Roboto', sans-serif",tooltipFontSize:20,tooltipFontStyle:"400",tooltipFontColor:"#fff",tooltipTitleFontFamily:"'Helvetica Neue', 'Helvetica', 'Segoe UI','Roboto', sans-serif",tooltipTitleFontSize:12,tooltipTitleFontStyle:"900",tooltipTitleFontColor:"#fff",tooltipYPadding:15,tooltipXPadding:15,tooltipCaretSize:8,tooltipCornerRadius:0,tooltipXOffset:10,tooltipTemplate:"<%if (label){%><%=label%>: <%}%><%= value %>",multiTooltipTemplate:"<%= value %>€",scaleShowGridLines:!0,scaleGridLineColor:"rgba(0,0,0,.1)",scaleGridLineWidth:1,bezierCurve:!0,bezierCurveTension:.4,pointDot:!0,pointDotRadius:6,pointDotStrokeWidth:3,pointHitDetectionRadius:30,datasetStroke:!0,datasetStrokeWidth:2,datasetFill:!0,legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<datasets.length; i++){%><li><span style="background-color:<%=datasets[i].lineColor%>"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>'}}});