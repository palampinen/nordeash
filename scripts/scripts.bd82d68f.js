"use strict";angular.module("nordeashApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("nordeashApp").controller("MainCtrl",["$scope","$timeout","Bank",function(a,b,c){a.banks=["Nordea","Osuuspankki"],a.my={bank:"Nordea"},a.upload=function(b){console.log(a.my.bank),a.my.bank&&(a.loading=!0,c.upload("csvFile",a.my.bank,d))},a.timeInterval=[];var d=function(c){a.timeInterval.push(c[0].date),a.timeInterval.push(c[c.length-1].date);var d=[],e=[];c=_.groupBy(c,function(a){return a.target.toLowerCase().trim()}),_.map(c,function(a,b){var c=[],f=[];_.map(a,function(a){parseFloat(a.sum.replace(",","."))>0?f.push(a):c.push(a)}),c.length&&d.push({id:b,percentage:0,length:c.length,sum:Math.round(_.reduce(c,function(a,b){var c=-1*parseFloat(b.sum.replace(",","."));return c>0?a+c:a},0))}),f.length&&e.push({id:b,percentage:0,length:f.length,sum:Math.round(_.reduce(f,function(a,b){var c=parseFloat(b.sum.replace(",","."));return c>0?a+c:a},0))})}),d=_.sortBy(d,function(a){return a.sum}).reverse(),e=_.sortBy(e,function(a){return a.sum}).reverse(),a.totalOutcome=_.reduce(d,function(a,b){return a+parseInt(b.sum)},0),a.totalIncome=_.reduce(e,function(a,b){return a+parseInt(b.sum)},0),a.outcome=d,a.income=e,b(function(){a.outcome=_.map(a.outcome,function(a){return a.percentage=Math.round(a.sum/d[0].sum*100),a}),a.income=_.map(a.income,function(a){return a.percentage=Math.round(a.sum/e[0].sum*100),a}),a.loading=!1},4e3),a.loaded=!0,a.mode="outcome"};a.changeMode=function(b){a.mode=b}}]).directive("customOnChange",function(){return{restrict:"A",link:function(a,b,c){var d=b.scope()[c.customOnChange];b.bind("change",d)}}}),angular.module("nordeashApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("nordeashApp").service("Bank",["$q","$http",function(a,b){var c={nordea:{delimiter:new RegExp('(	(?=(?:(?:[^"]*"){2})*[^"]*$))',"g"),date:0,sum:3,target:4,startRow:3},osuuspankki:{delimiter:new RegExp(";","g"),date:0,sum:2,target:5,startRow:1}};return{upload:function(a,b,d){b=b.toLowerCase();var e=document.getElementById(a),f=/^([a-zA-Z0-9\s_\\.\-:])+(.csv|.txt)$/,g=c[b].delimiter;if(f.test(e.value.toLowerCase()))if("undefined"!=typeof FileReader){var h=new FileReader;h.onload=function(a){for(var e=[],f=a.target.result.split("\n"),h=c[b].startRow;h<f.length;h++){f[h]=f[h].replace(g,"{;}");var i=f[h].split("{;}").slice(0,6);i[c[b].date]&&i[c[b].sum]&&e.push({date:i[c[b].date],sum:i[c[b].sum],target:i[c[b].target]})}d(e)},h.readAsText(e.files[0])}else alert("This browser does not support HTML5.");else alert("Please upload a valid CSV/TXT file.")}}}]);