"use strict";angular.module("nordeashApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("nordeashApp").controller("MainCtrl",["$scope","$timeout","Bank",function(a,b,c){a.upload=function(b){a.loading=!0,c.upload("csvFile",d)},a.timeInterval=[];var d=function(c){a.timeInterval.push(c[1].date),a.timeInterval.push(c[c.length-1].date);var d=[],e=[];c=_.groupBy(c,function(a){return a.target.toLowerCase().trim()}),_.map(c,function(a,b){var c=[],f=[];_.map(a,function(a){parseFloat(a.sum.replace(",","."))>0?f.push(a):c.push(a)}),c.length&&d.push({id:b,percentage:0,length:c.length,sum:Math.round(_.reduce(c,function(a,b){var c=-1*parseFloat(b.sum.replace(",","."));return c>0?a+c:a},0))}),f.length&&e.push({id:b,percentage:0,length:f.length,sum:Math.round(_.reduce(f,function(a,b){var c=parseFloat(b.sum.replace(",","."));return c>0?a+c:a},0))})}),d=_.sortBy(d,function(a){return a.sum}).reverse(),e=_.sortBy(e,function(a){return a.sum}).reverse(),a.totalOutcome=_.reduce(d,function(a,b){return a+parseInt(b.sum)},0),a.totalIncome=_.reduce(e,function(a,b){return a+parseInt(b.sum)},0),a.outcome=d,a.income=e,b(function(){a.outcome=_.map(a.outcome,function(a){return a.percentage=Math.round(a.sum/d[0].sum*100),a}),a.income=_.map(a.income,function(a){return a.percentage=Math.round(a.sum/e[0].sum*100),a}),a.loading=!1},4e3),a.loaded=!0,a.mode="outcome"};a.changeMode=function(b){a.mode=b}}]).directive("customOnChange",function(){return{restrict:"A",link:function(a,b,c){var d=b.scope()[c.customOnChange];b.bind("change",d)}}}),angular.module("nordeashApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("nordeashApp").service("Bank",["$q","$http",function(a,b){return{upload:function(a,b){var c=document.getElementById(a),d=/^([a-zA-Z0-9\s_\\.\-:])+(.csv|.txt)$/,e='(	(?=(?:(?:[^"]*"){2})*[^"]*$))',f=new RegExp(e,"g");if(d.test(c.value.toLowerCase()))if("undefined"!=typeof FileReader){var g=new FileReader;g.onload=function(a){for(var c=[],d=a.target.result.split("\n"),e=3;e<d.length;e++){d[e]=d[e].replace(f,"{;}");var g=d[e].split("{;}").slice(0,5);g[0]&&g[3]&&c.push({date:g[0],sum:g[3],target:g[4]})}b(c)},g.readAsText(c.files[0])}else alert("This browser does not support HTML5.");else alert("Please upload a valid CSV file.")}}}]);